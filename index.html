<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Gerenciador de Aeroporto ‚Äî Avan√ßado (HTML/CSS/JS)</title>
<style>
  :root{
    --bg:#dbeffd; --panel:#ffffffcc; --accent:#1f6feb; --tarmac:#2f2f2f;
    --taxi:#9c7a3a; --grass:#7fb26f; --hud:#0b1320cc;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  .app{display:grid;grid-template-columns:1fr 320px;gap:12px;height:100vh;padding:12px;background:linear-gradient(#d7f0ff,#eef9ff);}
  /* canvas area */
  .stage{position:relative;border-radius:10px;overflow:hidden;background:linear-gradient(#9fd3ff,#cff0ff);box-shadow:0 8px 30px rgba(10,30,60,.12);}
  #world{width:100%;height:100%;display:block}
  /* side panel */
  .panel{background:var(--panel);border-radius:10px;padding:12px;box-shadow:0 6px 18px rgba(0,0,0,.06);overflow:auto}
  h2{margin:6px 0;font-size:16px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  button{padding:8px 10px;border-radius:8px;border:0;background:var(--accent);color:#fff;cursor:pointer}
  small{color:#445}
  /* HUD */
  .hud{position:absolute;left:12px;top:12px;background:var(--hud);color:#fff;padding:8px 12px;border-radius:8px;backdrop-filter:blur(6px);}
  .hud div{font-size:14px;margin:4px 0}
  /* radar */
  .radar{position:relative;width:100%;height:240px;border-radius:8px;background:linear-gradient(#041b2d,#07334f);color:#7fd1ff;padding:10px;box-sizing:border-box}
  .radar-canvas{position:absolute;right:10px;top:10px;width:160px;height:160px;border-radius:50%;background:rgba(255,255,255,.02)}
  .list{font-size:13px;margin-top:6px;height:120px;overflow:auto}
  /* icons */
  .entity{position:absolute;transform:translate(-50%,-50%);font-size:20px;pointer-events:none;text-shadow:0 1px 0 #fff,0 2px 6px rgba(0,0,0,.35)}
  .plane{font-size:22px}
  .tug{font-size:20px}
  .robot{font-size:20px}
  .fire{font-size:22px}
  /* passengers */
  .passenger{position:absolute;width:8px;height:8px;border-radius:50%;background:#fff;opacity:.9;transform:translate(-50%,-50%);}
  /* controls */
  .control-row{display:flex;gap:8px;margin:6px 0;flex-wrap:wrap}
  .small-muted{font-size:12px;color:#556}
</style>
</head>
<body>
<div class="app">
  <div class="stage" id="stage">
    <canvas id="world"></canvas>

    <div class="hud" id="hud">
      <div><strong>Tower</strong></div>
      <div>Tempo: <span id="time">0</span>s</div>
      <div>Em fila: <span id="queued">0</span> ‚Ä¢ No solo: <span id="ground">0</span></div>
      <div class="small-muted">IA: <span id="iaMode">Autom√°tica</span></div>
    </div>

    <!-- dynamic icons will be appended here -->
  </div>

  <aside class="panel">
    <h2>Controles</h2>
    <div class="control-row">
      <button id="btn-toggle-ia">Desligar IA</button>
      <button id="btn-spawn">Gerar Avi√£o</button>
      <button id="btn-speed">Vel x2</button>
    </div>

    <h2>Radar</h2>
    <div class="radar" id="radarPanel">
      <div class="radar-canvas" id="radarCanvas"></div>
      <div style="margin-top:180px" class="small-muted">Minimap / Lista</div>
      <div class="list" id="radarList"></div>
    </div>

    <h2>Fila de Pouso</h2>
    <div id="queueList" class="list"></div>

    <h2>Eventos</h2>
    <div id="events" class="list"></div>

    <h2>Legenda</h2>
    <div class="small-muted">
      ‚úàÔ∏è Avi√£o ‚Ä¢ üöö Rebocador buscar ‚Ä¢ üöõ Rebocador pista ‚Ä¢ ü§ñ Rob√¥ ‚Ä¢ üöí Bombeiro
    </div>
  </aside>
</div>

<script>
/*
Airport Manager ‚Äî Advanced single-file
Platform: PC (Windows) ‚Äî edit in VS Code
Features: radar, IA tower, 2 runways, fire truck, passengers, HUD, multiple planes
Author: generated assistant (adapt and expand)
*/

// Canvas setup
const canvas = document.getElementById('world');
const ctx = canvas.getContext('2d');
const stage = document.getElementById('stage');
function resize(){ canvas.width = stage.clientWidth*devicePixelRatio; canvas.height = stage.clientHeight*devicePixelRatio; canvas.style.width = stage.clientWidth+'px'; canvas.style.height = stage.clientHeight+'px'; ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0); }
new ResizeObserver(resize).observe(stage);
resize();

// Map geometry (normalized coordinates 0..1)
const map = {
  runways: [
    [{x:0.08,y:0.22},{x:0.92,y:0.22}],
    [{x:0.08,y:0.62},{x:0.92,y:0.62}]
  ],
  taxiways: [
    [{x:0.92,y:0.22},{x:0.72,y:0.36},{x:0.5,y:0.42},{x:0.36,y:0.5},{x:0.28,y:0.66}],
    [{x:0.92,y:0.62},{x:0.72,y:0.48},{x:0.5,y:0.42}]
  ],
  gates: [
    {x:0.28,y:0.72},
    {x:0.34,y:0.72},
    {x:0.40,y:0.72},
    {x:0.46,y:0.72}
  ],
  serviceRoad: [{x:0.12,y:0.8},{x:0.46,y:0.74}]
};

// helpers
function sx(p){ return p.x * canvas.clientWidth; }
function sy(p){ return p.y * canvas.clientHeight; }
function spt(p){ return {x: sx(p), y: sy(p)}; }
function dist(a,b){ return Math.hypot(a.x-b.x,a.y-b.y); }
function lerp(a,b,t){ return {x:a.x+(b.x-a.x)*t, y:a.y+(b.y-a.y)*t}; }

// Entities storage
let planes = [];
let vehicles = []; // tow1, tow2, robot, fire
let eventsLog = [];
let queued = [];
let time = 0;
let speedMult = 1;
let iaOn = true;
let planeId = 0;

// UI refs
const queueList = document.getElementById('queueList');
const radarList = document.getElementById('radarList');
const eventsBox = document.getElementById('events');
const queuedEl = document.getElementById('queued');
const groundEl = document.getElementById('ground');
const timeEl = document.getElementById('time');
const iaModeEl = document.getElementById('iaMode');

// Create ground vehicles (as DOM icons so they overlay canvas)
function makeIcon(cls, emoji){ const d = document.createElement('div'); d.className = 'entity '+cls; d.innerText = emoji; stage.appendChild(d); return d; }
const tow1Icon = makeIcon('tug','üöö');
const tow2Icon = makeIcon('tug','üöõ');
const robotIcon = makeIcon('robot','ü§ñ');
const fireIcon = makeIcon('fire','üöí');

// Vehicle objects with simple path follow
function createVehicle(icon, speed=100){
  return {icon, pos:{x:canvas.clientWidth*0.6,y:canvas.clientHeight*0.75}, path:[], idx:0, speed};
}
const tow1 = createVehicle(tow1Icon,120);
const tow2 = createVehicle(tow2Icon,120);
const robot = createVehicle(robotIcon,80);
const fireTruck = createVehicle(fireIcon,110);
vehicles.push(tow1,tow2,robot,fireTruck);

// Plane state machine: waiting -> approach -> landing -> taxi -> gate -> serviced -> toRunway -> takeoff -> gone
function spawnPlane(auto=false){
  planeId++;
  const id = planeId;
  const approachX = 0.95;
  const approachY = 0.08 + Math.random()*0.14;
  const gateIndex = planes.length % map.gates.length;
  const gate = map.gates[gateIndex];
  const el = document.createElement('div');
  el.className = 'entity plane';
  el.innerText = '‚úàÔ∏è';
  stage.appendChild(el);
  const p = {
    id, el, state: auto? 'waiting':'waiting', pos:{x: sx({x:approachX,y:approachY}), y: sy({x:approachX,y:approachY})}, // start off top-right
    targetRunway: (id%2===0)?0:1,
    gate: spt(gate),
    speed: 90 + Math.random()*40,
    path: [],
    wp:0,
    fuel: 100,
    emergency:false,
    passengers: []
  };
  // append passengers for visual
  for(let i=0;i<6;i++){ const ps = document.createElement('div'); ps.className='passenger'; document.body.appendChild(ps); p.passengers.push(ps); }
  planes.push(p);
  queued.push(p);
  logEvent(`A${id} solicitou pouso`);
  updateUI();
  return p;
}

// Logging
function logEvent(txt){
  const timeStamp = Math.floor(time);
  eventsLog.unshift({t:timeStamp,msg:txt});
  eventsBox.innerHTML = eventsLog.slice(0,8).map(e=>`[${e.t}s] ${e.msg}`).join('<br>');
}

// Draw map
function drawMap(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // grass
  ctx.fillStyle = '#8fcf78'; ctx.fillRect(0,0,canvas.clientWidth,canvas.clientHeight);
  // runways
  map.runways.forEach((rw,i)=>{
    const a = spt(rw[0]), b = spt(rw[1]);
    ctx.fillStyle = '--';
    ctx.fillStyle = '#2f2f2f';
    const w = 68;
    ctx.beginPath(); ctx.moveTo(a.x,a.y-w/2); ctx.lineTo(b.x,b.y-w/2); ctx.lineTo(b.x,b.y+w/2); ctx.lineTo(a.x,a.y+w/2); ctx.closePath(); ctx.fill();
    // centerline
    ctx.strokeStyle = 'rgba(255,255,255,0.9)'; ctx.setLineDash([18,12]); ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke(); ctx.setLineDash([]);
    // runway label
    ctx.fillStyle = '#fff'; ctx.font='14px sans-serif'; ctx.fillText('Runway '+(i+1), a.x+6, a.y-30);
  });
  // taxiways
  map.taxiways.forEach(path=>{
    const s = path.map(spt);
    ctx.lineWidth = 26; ctx.strokeStyle = '#b99a49'; ctx.beginPath(); ctx.moveTo(s[0].x,s[0].y);
    for(let i=1;i<s.length;i++) ctx.lineTo(s[i].x,s[i].y);
    ctx.stroke();
  });
  // gates
  map.gates.forEach((g,i)=>{ const s=spt(g); ctx.fillStyle='#ddd'; ctx.fillRect(s.x-26,s.y-16,52,32); ctx.fillStyle='#000'; ctx.font='12px sans-serif'; ctx.fillText('Gate '+(i+1), s.x-20, s.y-22); });
}

// Update DOM icons positions
function updateIcons(){
  // planes (DOM elements)
  planes.forEach((p,idx)=>{
    p.el.style.left = p.pos.x+'px';
    p.el.style.top = p.pos.y+'px';
    // passenger animations near gate if at gate
    p.passengers.forEach((ps,i)=>{
      if(p.state==='gate'){
        const angle = (time*0.8 + i) % (Math.PI*2);
        ps.style.left = (p.gate.x + Math.cos(angle)*18) + 'px';
        ps.style.top = (p.gate.y + Math.sin(angle+0.6)*12) + 'px';
        ps.style.display = 'block';
      } else { ps.style.display='none'; }
    });
  });
  // vehicles
  vehicles.forEach(v=>{
    v.icon.style.left = v.pos.x+'px';
    v.icon.style.top = v.pos.y+'px';
  });
}

// Path utilities: return screen path from normalized path points
function pathToScreen(normPath){ return normPath.map(spt); }

// Simple path followper (moves pos towards current wp)
function followPath(obj, dt){
  if(!obj.path || obj.idx>=obj.path.length) return false;
  const target = obj.path[obj.idx];
  const d = dist(obj.pos, target);
  if(d < 4){ obj.idx++; if(obj.idx>=obj.path.length){ return false; } }
  const step = Math.min(1, (obj.speed * dt * speedMult)/Math.max(d,1));
  obj.pos = lerp(obj.pos, obj.path[obj.idx], step);
  return true;
}

// Tower AI: authorize logic
function towerAI(){
  if(!iaOn) return;
  // if there are queued and free runway, authorize next
  if(queued.length>0){
    // simple: prefer emergency, then first in queue
    let idx = queued.findIndex(p=>p.emergency);
    if(idx===-1) idx = 0;
    const plane = queued.splice(idx,1)[0];
    authorizeLanding(plane);
  }
}

// Authorize landing (manual or AI)
function authorizeLanding(plane){
  if(!plane) return;
  // set approach path to runway threshold then to taxiway/gate
  plane.state = 'approach';
  plane.fuel -= Math.random()*6;
  // build path: approach point -> touchdown on selected runway start -> taxi path -> gate
  const rw = map.runways[plane.targetRunway];
  const touchdown = {x: rw[0].x + 0.06*(rw[1].x-rw[0].x), y: rw[0].y};
  const touchdownS = spt(touchdown);
  const taxiPath = pathToScreen(map.taxiways[plane.targetRunway % map.taxiways.length].concat([plane.gate]));
  // combine
  plane.path = [ {x:plane.pos.x, y:plane.pos.y}, touchdownS, ...taxiPath ];
  plane.wp = 1;
  logEvent(`A${plane.id} autorizada para pouso (Runway ${plane.targetRunway+1})`);
  updateUI();
}

// Manual UI: authorize next in queue
document.getElementById('btn-spawn').addEventListener('click', ()=>spawnPlane(true));
document.getElementById('btn-toggle-ia').addEventListener('click', ()=>{
  iaOn = !iaOn; document.getElementById('btn-toggle-ia').innerText = iaOn? 'Desligar IA' : 'Ligar IA'; iaModeEl.innerText = iaOn? 'Autom√°tica' : 'Manual';
});
document.getElementById('btn-speed').addEventListener('click', ()=>{
  speedMult = speedMult===1?2:1; document.getElementById('btn-speed').innerText = speedMult===1? 'Vel x2' : 'Vel x1';
});

// manual authorize next
document.getElementById('radarPanel').addEventListener('click', ()=>{ if(queued.length>0) { const p = queued.shift(); authorizeLanding(p); updateUI(); } });

// emergency random event: low fuel -> trigger fire/rescue
function maybeEmergency(){
  const p = planes[Math.floor(Math.random()*planes.length)];
  if(p && p.state==='approach' && Math.random()<0.08){
    p.emergency = true;
    logEvent(`EMERG√äNCIA: A${p.id} com problema (prioridade)`);
    // dispatch fire truck to gate area after landing
    setTimeout(()=>{ dispatchFire(p.gate); }, 1200);
  }
}

// dispatch fire truck to point
function dispatchFire(point){
  fireTruck.path = [ {x:fireTruck.pos.x,y:fireTruck.pos.y}, point ];
  fireTruck.idx = 0;
  logEvent('Bombeiros enviados');
}

// Ground control: when plane reaches gate, schedule servicing
function groundControl(plane){
  if(plane.state==='taxi' && plane.wp >= plane.path.length-1){
    plane.state = 'gate';
    logEvent(`A${plane.id} estacionou no gate`);
    // assign tow1 to fetch if needed (simulation: tow1 moves to plane.gate)
    tow1.path = [ {x:tow1.pos.x,y:tow1.pos.y}, plane.gate ];
    tow1.idx = 0;
    // robot goes to gate
    robot.path = [ {x:robot.pos.x,y:robot.pos.y}, plane.gate ];
    robot.idx = 0;
    // after service, schedule to runway
    setTimeout(()=>{ plane.state='serviced'; logEvent(`A${plane.id} abastecido e carregado`); setTimeout(()=>{ scheduleToRunway(plane); }, 1000); }, 2200);
  }
}

function scheduleToRunway(plane){
  plane.state = 'toRunway';
  // pick runway 0 or 1; choose the one with less traffic (very simple)
  plane.targetRunway = (plane.targetRunway+1) % map.runways.length;
  const exitPath = pathToScreen(map.taxiways[plane.targetRunway % map.taxiways.length]).slice().reverse();
  plane.path = [ plane.gate, ...exitPath, spt({x: map.runways[plane.targetRunway][1].x, y: map.runways[plane.targetRunway][1].y}) ];
  plane.wp = 0;
  // tow2 will pull it to runway
  tow2.path = [ {x:tow2.pos.x,y:tow2.pos.y}, plane.gate, spt(map.runways[plane.targetRunway][1]) ];
  tow2.idx = 0;
  logEvent(`A${plane.id} em rota para decolagem (Runway ${plane.targetRunway+1})`);
}

// movement step per frame
let last = performance.now();
function step(now){
  const dt = (now - last)/1000; last = now;
  if(dt>0.5) return requestAnimationFrame(step);
  // update time
  time += dt * speedMult;
  timeEl.innerText = Math.floor(time);

  // Tower AI interval
  if(Math.random() < 0.015*dt*60) towerAI();

  // maybe emergency
  if(Math.random() < 0.004*dt*60) maybeEmergency();

  // Move planes along their path
  planes.forEach(p=>{
    if(p.path && p.wp < p.path.length){
      // move toward current wp
      const target = p.path[p.wp];
      const d = dist(p.pos,target);
      const step = Math.min(1, (p.speed * dt * speedMult)/Math.max(d,1));
      p.pos = lerp(p.pos, target, step);
      if(dist(p.pos,target) < 6) p.wp++;
      // state transitions depending on wp & original state
      if(p.state==='approach' && p.wp >= 2){ p.state='landing'; }
      if(p.state==='landing' && p.wp >= (p.path.length-1)){ p.state='taxi'; groundControl(p); }
      if(p.state==='toRunway' && p.wp >= p.path.length-1){ p.state='takeoff'; logEvent(`A${p.id} decolando`); setTimeout(()=>{ removePlane(p); }, 1500); }
    } else {
      // if waiting in queue, slowly approach waiting holding position
      if(p.state==='waiting'){
        // hold position off-screen-ish (no movement)
      }
    }
    // fuel drain when waiting/approach
    if(p.state==='waiting' || p.state==='approach'){ p.fuel -= 0.02 * dt * speedMult; if(p.fuel < 18 && !p.emergency){ p.emergency = true; logEvent(`A${p.id} com baixo combust√≠vel ‚Äî prioridade`); } }
  });

  // vehicles follow their paths
  vehicles.forEach(v=>{ if(v.path && v.idx < v.path.length){ const target = v.path[v.idx]; const d = dist(v.pos,target); const step = Math.min(1, (v.speed * dt * speedMult)/Math.max(d,1)); v.pos = lerp(v.pos, target, step); if(dist(v.pos,target) < 6) v.idx++; } });

  // cleanup planes array if removed
  updateIcons();
  drawMap();
  updateUI();

  requestAnimationFrame(step);
}

function removePlane(p){
  p.el.remove();
  p.passengers.forEach(ps=>ps.remove());
  planes = planes.filter(x=>x!==p);
  logEvent(`A${p.id} saiu do aeroporto`);
}

// UI update (queue, radar)
function updateUI(){
  queuedEl.textContent = queued.length;
  groundEl.textContent = planes.filter(p=>p.state!=='waiting').length;
  // queue list
  queueList.innerHTML = queued.map(p=>`A${p.id} ${p.emergency?'<strong style="color:#e74c3c">EMG</strong>':''}`).join('<br>');
  // radar list
  radarList.innerHTML = planes.slice().reverse().map(p=>`A${p.id} ‚Äî ${p.state} ${p.emergency?'<span style="color:#f77">‚òÖ</span>':''}`).join('<br>');
  // position icons are updated in updateIcons()
}

// initial population
for(let i=0;i<2;i++) spawnPlane(true);
spawnPlane(true);

// start main loop
requestAnimationFrame(step);

// small helpers: expose manual authorize next via clicking panel
document.getElementById('radarPanel').addEventListener('dblclick', ()=>{
  if(queued.length>0) { const p = queued.shift(); authorizeLanding(p); updateUI(); }
});

// allow clicking queued list to authorize first
queueList.addEventListener('click', ()=>{ if(queued.length>0){ const p=queued.shift(); authorizeLanding(p); updateUI(); } });

// accessibility: spawn plane every 10s into queue automatically
setInterval(()=> spawnPlane(true), 10000);

</script>
</body>
</html>
